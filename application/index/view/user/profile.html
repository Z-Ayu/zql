{layout name="nofooter"}
<div style="background-color: #fff;margin-top: 0;">
    <div class="container clearfix article-container ">
        <div class="row">
            <div class="list-group col-md-2" id="titles">
                <span class="list-group-item" style="background-color:#f7f7f7; font-weight:bold;">个人资料</span>
                <a href="#" class="list-group-item">　基本资料</a>
                <a href="__STATIC__/index/user/crop" class="list-group-item" id="avatar" target="avatar">　头像设置</a>
                <a href="#" class="list-group-item">　安全设置</a>
                <span class="list-group-item" style="background-color:#f7f7f7;font-weight:bold;">隐私设置</span>
                <a href="#" class="list-group-item">　我的粉丝<b class="badge">{$fanNum}</b></a>
                <a href="#" class="list-group-item">　我的关注<b class="badge">{$followNum}</b></a>
                <a href="#" class="list-group-item">　我的好友<b class="badge">{$num}</b></a>
                <a href="#" class="list-group-item">　好友申请<b class="badge">{$applyNum}</b></a>
                <a href="#" class="list-group-item">　我的申请<b class="badge">{$applyedNum}</b></a>
                <a href="#" class="list-group-item">　我的收藏<b class="badge">{$keepNum}</b></a>
                <a href="#" class="list-group-item">　我的问答<b class="badge">{$askNum}</b></a>
                <a href="#" class="list-group-item">　导游申请<b class="badge">{$guideNum}</b></a>
                <a href="#" class="list-group-item">　我的同行<b class="badge">{$peersNum}</b></a>
            </div>
            <div class="col-md-10" id="profile">

                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">基本资料</h3>
                    </div>
                    <div class="panel-body text-center">
                        <div style="display:none;" id="alert" class="alert alert-danger alert-dismissible" role="alert">
                            <button type="button" class="close" data-dismiss="alert"><span
                                    aria-hidden="true">&times;</span><span
                                    class="sr-only">关闭</span></button>
                            <strong>提示!</strong>
                        </div>
                        <div class="row">

                            <div class="col-md-2">用户名：</div>
                            <input type="hidden" id="uid" value="{$uid}"/>

                            <div class="col-md-3">
                                <input type="text" value="{$username}" class="form-control" disabled/>
                            </div>
                            <div><a href="__STATIC__/index/user/detail/u/{$uid}.html"><span
                                    class="glyphicon glyphicon-send"></span> 我的主页</a></div>
                        </div>
                        <hr/>

                        <div class="row">

                            <div class="col-md-2">邮　箱：</div>

                            <div class="col-md-3">
                                <input type="text" value="{$email}" value="{$email}" class="form-control" disabled/>
                            </div>

                        </div>
                        <hr/>
                        <div class="row">

                            <div class="col-md-2">性　别：</div>

                            <div class="col-md-2">
                                <select class="form-control" name="sex">
                                    <option value="0">女</option>
                                    <option value="1" {$sex}>男</option>
                                </select></div>

                        </div>
                        <hr/>

                        <div class="row">

                            <div class="col-md-2">生　日：</div>

                            <div class="col-md-2"><select class="form-control" name="year" id="sel_year"
                                                          rel="{$year}"></select></div>

                            <div class="col-md-2"><select class="form-control" name="month" id="sel_month"
                                                          rel="{$month}"></select></div>

                            <div class="col-md-2"><select class="form-control" name="day" id="sel_day"
                                                          rel="{$day}"></select></div>

                        </div>
                        <hr/>
                        <div class="row">

                            <div class="col-md-2">所在地：</div>

                            <div class="col-md-2"><select class="form-control" id="seachprov" name="seachprov"
                                                          onChange="changeComplexProvince(this.value, sub_array, 'seachcity', 'seachdistrict');"></select>
                            </div>

                            <div class="col-md-3"><select class="form-control" id="seachcity" name="homecity"
                                                          onChange="changeCity(this.value,'seachdistrict','seachdistrict');"></select>
                            </div>

                            <div class="col-md-3"><span id="seachdistrict_div"><select class="form-control"
                                                                                       id="seachdistrict"
                                                                                       name="seachdistrict"></select></span>
                            </div>

                        </div>
                        <hr/>
                        <div class="row">

                            <div class="col-md-2">个人简介：</div>

                            <div class="col-md-8">
                            <textarea name="motto" placeholder="介绍一下自己"
                                      style="width:calc(100% - 20px);height:160px;padding:10px;"><?=empty($motto) ? '' : $motto;?></textarea>
                            </div>

                        </div>
                        <hr/>
                        <div class="col-md-5">
                            <button type="submit" id="base" class="btn btn-primary">保存</button>
                        </div>
                    </div>
                </div>

                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">头像设置</h3>
                    </div>
                    <div class="panel-body">
                        <iframe name="avatar" src="__STATIC__/index/user/crop.html" width="100%" height="460px"
                                border="0"
                                frameborder="0"></iframe>
                    </div>
                </div>

                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">安全设置</h3>
                    </div>
                    <div class="panel-body">
                        <form action="__STATIC__{:url('user/repasswd')}" method="post">

                            <div class="row">

                                <div class="col-md-2">原密码：</div>

                                <div class="col-md-3">
                                    <input type="password" name="password" class="form-control" required/>
                                </div>

                            </div>
                            <hr/>
                            <div class="row">

                                <div class="col-md-2">新密码：</div>

                                <div class="col-md-3">
                                    <input type="password" name="repassword1" class="form-control" required/>
                                </div>

                            </div>
                            <hr/>
                            <div class="row">

                                <div class="col-md-2">重复密码：</div>

                                <div class="col-md-3">
                                    <input type="password" name="repassword2" class="form-control" required/>
                                </div>

                            </div>
                            <hr/>
                            <div class="row">

                                <div class="col-md-5">
                                    <input type="submit" value="确认修改" class="btn btn-primary"/>
                                </div>

                            </div>
                            <hr/>
                        </form>
                    </div>
                </div>


                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">我的粉丝 <b style="font-size: 12px;">共有 {$fanNum} 个粉丝</b></h3>
                    </div>
                    <div class="panel-body">
                        <div class="row" id="fans">
                            <input type="hidden" value='{$allFans}' name="allFans"/>
                            {$fans}
                        </div>
                        <div class="row">
                            <div class="col-md-offset-10">
                                <button class="btn btn-warning" id="delete-fan">删除粉丝？</button>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">我的关注 <b style="font-size: 12px;">共关注 {$followNum} 个用户</b></h3>
                    </div>
                    <div class="panel-body">
                        <div class="row" id="follows">
                            <input type="hidden" value='{$allFollows}' name="allFollows"/>
                            {$follow}
                        </div>
                        <div class="row">
                            <span style="padding-left: 20px;">Tips:为了加强与用户的沟通，反馈中心（admin）不允许取消关注！</span>
                            <div class="col-md-offset-10">
                                <button class="btn btn-warning" id="delete-follow">取消关注？</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">我的好友 <b style="font-size: 12px;">共有 {$num} 个好友</b></h3>
                    </div>
                    <div class="panel-body">
                        <div class="row" id="friends">
                            <input type="hidden" value='{$allFriends}' name="oldFriends"/>
                            {$friends}
                        </div>
                        <div class="row">
                            <div class="col-md-offset-10">
                                <button class="btn btn-warning" id="delete-friend">确认删除？</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">好友申请 <b style="font-size: 12px;">共有 {$applyNum} 个好友申请</b></h3>
                    </div>
                    <div class="panel-body">
                        <form action="__STATIC__/index/user/apply/act/apply.html" method="post">
                            <div class="row" id="apply">
                                {$apply}
                            </div>
                            <div class="row">
                                <div class="col-md-offset-10">
                                    {if !empty($apply)}
                                    <button class="btn btn-warning" type="submit">确认同意？</button>
                                    {/if}
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">我发送的好友请求 <b style="font-size: 12px;">共有 {$applyedNum} 个申请</b></h3>
                    </div>
                    <div class="panel-body">
                        <div class="row" id="applyed">
                            {$applyed}
                        </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">我的收藏 <b style="font-size: 12px;">共有 {$keepNum} 个收藏</b></h3>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            {$keep}
                        </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">我的问答 <b style="font-size: 12px;">共有 {$askNum} 个关注的问答</b></h3>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            {$ask}
                        </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">导游申请结果 <b style="font-size: 12px;">共有 {$guideNum} 个</b></h3>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            {$guide}
                        </div>
                    </div>
                </div>

                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">我的同行 <b style="font-size: 12px;">共有 {$peersNum} 个同行</b></h3>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            {$peers}
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <script>
        $(function () {
            $.ms_DatePicker({
                YearSelector: ".sel_year",
                MonthSelector: ".sel_month",
                DaySelector: ".sel_day"
            });
            $.ms_DatePicker();

            var $title = $('#titles').children('a');

            var $profile = $('#profile').children('div');

            $profile.eq(0).show().siblings().hide();
            $title.eq(0).addClass('active').siblings().removeClass('action');

            $title.click(function () {

                var index = $('#titles').children('a').index(this);

                $(this).addClass('active').siblings().removeClass('active');

                $profile.eq(index).show().siblings().hide();

            });

            initComplexArea('seachprov', 'seachcity', 'seachdistrict', area_array, sub_array, '{$pro}', '{$city}', '{$area}');

            $('#base').click(function () {
                //alert(showAreaID());
                $.ajax({
                    type: "POST",
                    url: "/index/user/ajaxBase.html",
                    dataType: 'json',
                    data: {
                        "sex": $('select[name="sex"]').val(),
                        "year": $('#sel_year').val(),
                        "month": $('#sel_month').val(),
                        "day": $('#sel_day').val(),
                        "city": showAreaID(),
                        "motto": $('textarea[name="motto"]').val(),
                        'city_no': getAreaID()

                    },
                    success: function (msg) {
                        if (0 == msg.code) {
                            $('#alert').children('span').remove();
                            $('#alert').removeClass('alert-danger').addClass('alert-success');
                            $('#alert').show().append('<span>' + msg.msg + '</span>');
                        } else {
                            $('#alert').children('span').remove();
                            $('#alert').removeClass('alert-success').addClass('alert-danger');
                            $('#alert').show().append('<span>' + msg.msg + '</span>');
                        }
                    }
                });

            });

            $('#delete-friend').click(function () {
                var allChecked = '';
                $input = $('#friends div');
                var arr = '{';
                for (var i = 0; i < $input.length; i++) {
                    $check = $input.eq(i).children('span').children('input[type="checkbox"]');
                    if ($check.is(':checked')) {
                        arr += '"' + $check.val() + '"' + ':' + '"' + $input.eq(i).children('span').children('input[type="hidden"]').val() + '",';
                    }
                }
                arr += '}';
                if ('{}' == arr) {
                    alert('请选择好友！');
                } else {
                    $.ajax({
                        type: 'post',
                        dataType: 'json',
                        url: '/index/user/ajaxData.html?type=FRI',
                        data: {
                            friends: JSON.parse(arr.substring(0, arr.length - 2) + '}'),
                            oldFriends: $('input[name="oldFriends"]').val(),
                            userId: $('#uid').val()
                        },
                        success: function (msg) {
                            alert(msg.msg);
                        },
                        error: function () {
                            alert('Error!');
                        }
                    })
                }
            });
            // 删除粉丝
            $('#delete-fan').click(function () {
                var allChecked = '';
                $input = $('#fans div');
                var arr = '{';
                for (var i = 0; i < $input.length; i++) {
                    $check = $input.eq(i).children('span').children('input[type="checkbox"]');
                    if ($check.is(':checked')) {
                        arr += '"' + $check.val() + '"' + ':' + '"' + $input.eq(i).children('span').children('input[type="hidden"]').val() + '",';
                    }
                }
                arr += '}';
                if ('{}' == arr) {
                    alert('请选择好友！');
                } else {
                    $.ajax({
                        type: 'post',
                        dataType: 'json',
                        url: '/index/user/ajaxData.html?type=FAN',
                        data: {
                            friends: JSON.parse(arr.substring(0, arr.length - 2) + '}'),
                            oldFriends: $('input[name="allFans"]').val(),
                            userId: $('#uid').val()
                        },
                        success: function (msg) {
                            alert(msg.msg);
                        },
                        error: function () {
                            alert('Error!');
                        }
                    })
                }
            });
            // 取消关注
            $('#delete-follow').click(function () {
                var allChecked = '';
                $input = $('#follows div');
                var arr = '{';
                for (var i = 0; i < $input.length; i++) {
                    $check = $input.eq(i).children('span').children('input[type="checkbox"]');
                    if ($check.is(':checked')) {
                        arr += '"' + $check.val() + '"' + ':' + '"' + $input.eq(i).children('span').children('input[type="hidden"]').val() + '",';
                    }
                }
                arr += '}';
                if ('{}' == arr) {
                    alert('请选择好友！');
                } else {
                    $.ajax({
                        type: 'post',
                        dataType: 'json',
                        url: '/index/user/ajaxData.html?type=FOL',
                        data: {
                            friends: JSON.parse(arr.substring(0, arr.length - 2) + '}'),
                            oldFriends: $('input[name="allFollows"]').val(),
                            userId: $('#uid').val()
                        },
                        success: function (msg) {
                            alert(msg.msg);
                        },
                        error: function () {
                            alert('Error!');
                        }
                    })
                }
            });
        });
        //得到地区码
        function getAreaID() {
            var area = 0;
            if ($("#seachdistrict").val() != "0") {
                area = $("#seachdistrict").val();
            } else if ($("#seachcity").val() != "0") {
                area = $("#seachcity").val();
            } else {
                area = $("#seachprov").val();
            }
            return area;
        }

        function showAreaID() {
            //地区码
            var areaID = getAreaID();
            //地区名
            var areaName = getAreaNamebyID(areaID);

            return areaName;
            //alert("您选择的地区码：" + areaID + "      地区名：" + areaName);
        }

        //根据地区码查询地区名
        function getAreaNamebyID(areaID) {
            var areaName = "";
            if (areaID.length == 2) {
                areaName = area_array[areaID];
            } else if (areaID.length == 4) {
                var index1 = areaID.substring(0, 2);
                areaName = area_array[index1] + " " + sub_array[index1][areaID];
            } else if (areaID.length == 6) {
                var index1 = areaID.substring(0, 2);
                var index2 = areaID.substring(0, 4);
                areaName = area_array[index1] + " " + sub_array[index1][index2] + " " + sub_arr[index2][areaID];
            }
            return areaName;
        }

    </script>
</div>